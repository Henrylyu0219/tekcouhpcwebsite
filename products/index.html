<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Products - TekcoUHPC</title>

  <!-- Fonts -->
  <link rel="stylesheet" href="https://use.typekit.net/jry3xql.css">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <!-- Global & Effects CSS（用 BASE 前缀，见下面脚本） -->
  <script>
    // 统一管理路径前缀：部署在根目录用 ''；部署在 /tekcouhpc 用 '/tekcouhpc'
    window.__BASE_PATH__ = '';  // 改这里即可
  </script>
  <script>
    (function(){
      const BASE = window.__BASE_PATH__ || '';
      const link = (href) => {
        const l = document.createElement('link');
        l.rel = 'stylesheet';
        l.href = BASE + href;
        document.write(l.outerHTML);
      };
      // header.css & softload.css
      link('/assets/header.css');
      link('/assets/softload.css');
    })();
  </script>
</head>
<body>
  <!-- Header -->
  <header class="tk-header">
    <div class="tk-header__inner">
      <a class="tk-logo" href="" aria-label="TekcoUHPC Home" id="homeLink">
        <img id="logoImg" alt="TekcoUHPC" />
      </a>

      <nav class="tk-nav tk-nav--desktop">
        <a id="navHome">Home</a>
        <a class="is-active" id="navProducts">Products</a>
        <a id="navContact">Contact</a>
      </nav>

      <button class="tk-burger" aria-label="Open Menu" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>
    </div>

    <nav class="tk-nav tk-nav--mobile" hidden>
      <a id="mnavHome">Home</a>
      <a class="is-active" id="mnavProducts">Products</a>
      <a id="mnavContact">Contact</a>
    </nav>
  </header>

  <main class="page-products">
    <!-- 保留你的原有标题/栅格样式；这里只提供容器 -->
    <section class="hero">
      <h1 class="hero__kicker">Our products</h1>
      <p class="hero__sub">Curated UHPC surfaces and textures for architecture &amp; interiors</p>
    </section>

    <!-- 渲染容器（自动填充） -->
    <section class="catalog fx-softload" id="catalog"></section>
  </main>

  <!-- Global & Effects JS（用 BASE 前缀加载） -->
  <script>
    (function(){
      const BASE = window.__BASE_PATH__ || '';
      const scr = (src) => {
        const s = document.createElement('script');
        s.src = BASE + src;
        document.write(s.outerHTML);
      };
      scr('/assets/header.js');
      scr('/assets/softload.js');
    })();
  </script>

  <!-- 页面渲染逻辑：从 JSON 读取并生成 tiles -->
  <script type="module">
    const BASE = window.__BASE_PATH__ || '';

    // 修正头部的链接与 logo 路径（避免相对路径失效）
    (function fixHeaderPaths(){
      const q = (id) => document.getElementById(id);
      q('homeLink').href = BASE + '/index.html';
      q('logoImg').src = BASE + '/assets/logo.svg';

      q('navHome').href = BASE + '/index.html';
      q('navProducts').href = BASE + '/products/index.html';
      q('navContact').href = BASE + '/contact/index.html';

      q('mnavHome').href = BASE + '/index.html';
      q('mnavProducts').href = BASE + '/products/index.html';
      q('mnavContact').href = BASE + '/contact/index.html';
    })();

    // 渲染 catalog
    async function renderCatalog(){
      const res = await fetch(BASE + '/assets/products.json', { cache: 'no-cache' });
      const items = await res.json();

      // 如果你希望只存 name/slug，让图片名自动推导，也可以启用下面这个函数替换 img：
      // const toImg = (name) => name.replace(/\s+/g,'') + '.png';

      const IMG_DIR = BASE + '/img/ProductsCover/';
      const html = items.map(({name, slug, img}) => `
        <a class="tile" href="./${slug}.html">
          <figure class="tile__figure">
            <img loading="lazy" src="${IMG_DIR}${img}" alt="${name}" />
            <figcaption class="tile__label">${name}</figcaption>
          </figure>
        </a>
      `).join('');

      const el = document.getElementById('catalog');
      el.innerHTML = html;

      // 绑定柔和加载效果到新生成的节点
      if (window.tkSoftloadInit) window.tkSoftloadInit(el);
    }

    renderCatalog().catch(err => {
      console.error('Render products failed:', err);
      const el = document.getElementById('catalog');
      el.innerHTML = '<p style="color:#888">Failed to load products.</p>';
    });
  </script>
</body>
</html>
